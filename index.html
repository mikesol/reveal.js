<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>purcell</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/sky.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->

	    <script src="../purcell/third_party/jquery/jquery-1.11.1.min.js" type="text/javascript"></script>
	    <script src="../purcell/third_party/spin/spin.js" type="text/javascript"></script>
	    <script src="../purcell/third_party/spin/jquery.spin.js" type="text/javascript"></script>
	    <script src="../purcell/third_party/snap/snap.svg-min.js" type="text/javascript"></script>
	    <script src="../purcell/js/purcell.js" type="text/javascript"></script>
	    <script src="../purcell/js/purcell_websocket.js"
	    type="text/javascript"></script>
	    <!--<script src="../third_party/sql.js/sql.js" type="text/javascript"></script>
	    <script src="../js/purcell_sql_js.js"
	    type="text/javascript"></script>-->
	    <link href="../purcell/css/purcell.css" rel="stylesheet" type="text/css"></link>

	    <script type="text/javascript">
	    var GLOBAL_WRITE_FLAG = false;
	    var WS_URL = 'ws://localhost:9000';
	    var PASSWORD = "not_telling_you";
	    $(function () {
 purcell.make_session('page1',['page1']);
 purcell.make_session('page2',['page2','page3']);
 purcell.make_session('page4',['page4','page5','page6','page7']);
 purcell.make_session('page8',['page8']);
 purcell.make_session('simple_editor',['simple_editor']);
	    });
	    </script>
	</head>
<script type="text/javascript" src="purcell_extension.js"></script>
	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Purcell</h1>
					<p>
					A dynamic relational model of music
					engraving
					</p>
					<p id="loading_text">[loading 0%]</p>
					<p id="loading_text"
					style="font-size:20px;">(please use
					Google Chrome or Safari to view this
					page)</p>
					<div id="init_spin"></div>
					<script>
					$(function() {
					  //var target =
					  //var target = document.getElementById('init_spin');
					  //var spinner
					  $('#init_spin').spin({length:100,
					  radius:40,
					  width:10});
					})
					</script>
				</section>

				<section>
					<p>
					purcell is a tool that allows
					musical scores to be embedded and
					interacted with dynamically.
					Below is a purcell score!
					</p>
				    <script type="text/javascript">
				      $(function () {
				         var out = make_purcell_header();
				         out = make_first_example(out);
				         out = array_to_single_sql(out);
				         if (GLOBAL_WRITE_FLAG) {
				           purcell.make_websocket('page1',{ws_url:WS_URL,out:out, cache:"simple_example.db", pwd:PASSWORD});
				         } else {
				           purcell.make_websocket('page1',{ws_url:WS_URL,initialize:"simple_example.db"});
				         }
				      });
				    </script>
					<svg height="200px" id="page1" width="50%"></svg>
				</section>

				<section>
					<p>
					Of course, it is more interesting if
					we can add elements dynamically.
					Click on the buttons below to add
					some quarter notes, rests (R),
					and barlines (|).
					</p>
				    <script type="text/javascript">
				      $(function() {
				         purcell.$e$$ion$.page1.function_queue.push(
				         function () {
				         update_loading(10);
				         var out = make_purcell_header();
				         out = array_to_single_sql(out);
				         if (GLOBAL_WRITE_FLAG) {
				           purcell.make_websocket('page2',{ws_url:WS_URL,out:out,
				           cache:"blank_editor.db",
				           pwd:PASSWORD});
				         } else {
				           purcell.make_websocket('page2',
				           {ws_url:WS_URL,initialize:"blank_editor.db"});
				         }
				      });
				      });
				    </script>
				<div id="webpage">
			      <div class="purcell_content">
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(null)">&#8635;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(90)">&#8606;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(30)">&#8592;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(-30)">&#8594;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(-90)">&#8608;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(3.1416)">&#8618;</button>
			      </div>
			      <svg height="200px" id="page2" width="100%"></svg>
			      <div id="page2_spinny">
			      </div>
			      <div class="purcell_content">
			        <span class="text-span" id="page2_currentPitch"></span>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(0)">C</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(1)">D</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(2)">E</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(3)">F</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(4)">G</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(5)">A</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(6)">B</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(null)">R</button>
			        <button class="barline" onclick="purcell.$e$$ion$.page2.addBarLineN()">|</button>
			      </div>
			    </div>					
				</section>

				<section>
					<p>
					Look like the score on the previous
					page?  That's because purcell scores
					are created on a server and can be
					visualzied anywhere.
					</p>
				<div id="webpage">
			      <div class="purcell_content">
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(null)">&#8635;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(90)">&#8606;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(30)">&#8592;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(-30)">&#8594;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(-90)">&#8608;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.shiftX(3.1416)">&#8618;</button>
			      </div>
			      <svg height="200px" id="page3" width="100%"></svg>
			      <div id="page3_spinny">
			      </div>
			      <div class="purcell_content">
			        <span class="text-span" id="page3_currentPitch"></span>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(0)">C</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(1)">D</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(2)">E</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(3)">F</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(4)">G</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(5)">A</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(6)">B</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.page2.addNoteN(null)">R</button>
			        <button class="barline" onclick="purcell.$e$$ion$.page2.addBarLineN()">|</button>
			      </div>
			    </div>					
					<p>
					Keep editing
					and flip back and forth between the
					pages to see realtime updating, or
					go forwards to see more cool stuff.
					</p>
				</section>

				<section>
					<p>
					purcell engraving is mostly done in
					SQL.  purcell implements a
					relational model of music engraving,
					where database triggers propagate
					data into tables representing
					engraved music.
					</p>
				     <script type="text/javascript">
				      $(function () {
                                         purcell.$e$$ion$.page2.function_queue.push(
				         function () {
				         update_loading(20);
				         var out = make_purcell_header();
				         out = make_complex_example(out)
				         out = array_to_single_sql(out);
				         if (GLOBAL_WRITE_FLAG) {
				           purcell.make_websocket('page4',{ws_url:WS_URL,out:out,cache:"complex_example.db",pwd:PASSWORD});
				         } else {
				           purcell.make_websocket('page4',{ws_url:WS_URL,initialize:"complex_example.db"});
				         }
				      })});
				    </script>

					<svg height="200px" id="page4" width="100%"></svg>
			      <div id="page3_spinny">
			      </div>
					<p>
					This data can be rendered to any
					surface that draws lines, curves,
					polygons and glyphs.  Above, the
					surface is SVG.
					</p>
				</section>
				<section>
					<p>
					The power of using a relational
					model in music engraving is that
					arbitrary data about a score can be
					retreived.
					</p>
					<svg height="200px" id="page5" width="100%"></svg>
					<p>
					Click on "execute" below to execute
					the SQL query.<br>In purcell speak, it
					translates to "select the ID of all
					notes in the score where the pitch
					is B or E."
					</p>
			      <div id="page5_spinny"></div>
				<textarea id="sql_input_page5" style="font-size:20px;width:100%"
				rows="3"
				>SELECT pitch.id AS id
FROM pitch JOIN name ON pitch.id = name.id
WHERE (pitch.val = 6 OR pitch.val = 2) AND (name.val = 'note');
				</textarea><div style="display:table;margin:auto">
                                <button class="pitch"
				onclick="interpret_query_page5()">execute</button>
				<div id="sql_result_page5"></div>
				</section>
				<section>
					<p>
					Use this page as a SQL sandbox for
					the score below.
					</p>
					<svg height="200px" id="page6" width="100%"></svg>
					<p>
					Here are some suggestions.
					</p>
			      <div id="page6_spinny">
			      </div>
					<pre>
<code>--Only execute one query at a time. Queries are delimited by semicolons.
SELECT accidental.id AS id FROM accidental;
SELECT name.id AS id FROM name WHERE name.val = 'clef';
SELECT beam.val AS val FROM beam GROUP BY beam.val;
SELECT x_position.id AS id, x_position.val AS val
  FROM x_position JOIN name ON x_position.id = name.id
  WHERE name.val = 'bar_line';
SELECT duration_log.id AS id FROM duration_log WHERE duration_log.val = -1;</code></pre>
				<textarea id="sql_input_page6" style="font-size:20px;width:100%"
				rows="3"
				>SELECT duration_log.id AS id FROM duration_log WHERE duration_log.val = -1;
				</textarea><div style="display:table;margin:auto">
                                <button class="pitch"
				onclick="interpret_query_page6()">execute</button>
				<div id="sql_result_page6"></div>
				</section>
				<section>
					<p>
					Modifications are possible as well.
					</p>
			      <div id="page7_spinny">
			      </div>
					<svg height="200px" id="page7" width="100%"></svg>
					<p>
					To change all sharps in the score
					above to flats, execute the
					statement below.
					</p>
									<textarea id="sql_input_page7" style="font-size:20px;width:100%"
				rows="3"
				>UPDATE accidental SET val = -1 WHERE val = 1;
				</textarea><div style="display:table;margin:auto">
                                <button class="pitch"
				onclick="interpret_query_page7()">execute</button>
				<div id="sql_result_page7"></div>
				</section>

				<section>
					<p>
					purcell is ideal for engraving music
					in embedded, dynamic, interactive,
					and animated contexts.
					</p>
					<script type="text/javascript">
				      $(function () {
                                         purcell.$e$$ion$.simple_editor.function_queue.push(
				         function () {
				         update_loading(70);
				         var out = make_purcell_header();
				         out = make_scale_example(out);
				         out = array_to_single_sql(out);
				         //console.log(out[0].sql);
				         purcell.$e$$ion$.page8.function_queue.push(make_draw_repertoire);
				         if (GLOBAL_WRITE_FLAG) {
  				           purcell.make_websocket('page8',{ws_url:WS_URL,out:out,cache:"scale_for_animation.db",pwd:PASSWORD});
				         } else {
				           purcell.make_websocket('page8',{ws_url:WS_URL,initialize:"scale_for_animation.db"});
				         }
				      })});
				      </script>
					<svg height="200px" id="page8" width="100%"></svg>
				</section>
				<section>
				<section>
					<h2>Mini-Editor</h2>
					<p>
					Check out the
					slides below to play with a slightly
					more robust editor.
					</p>
					<hr>
					<p>
					Clicking on the
					note name will add a note, and
					clicking on other buttons will
					control aspects of the next added
					note.
					</p>
					<hr>
					<p>
					Below the editor's slide, an SQL
					editor can be used to query the score.
					</p>
				</section>
				  <section>
				   <script type="text/javascript">
				      $(function () {
                                         purcell.$e$$ion$.page4.function_queue.push(
				         function () {
				         update_loading(50);
				         var out = make_purcell_header();
				         out = array_to_single_sql(out);
				         if (GLOBAL_WRITE_FLAG) {
  				           purcell.make_websocket('simple_editor',{ws_url:WS_URL,out:out});
				         } else {
				           purcell.make_websocket('simple_editor',{ws_url:WS_URL,initialize:"blank_editor.db"});
				         }
				      })});
				    </script>

					<div id="webpage">
			      <div class="purcell_content">
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.shiftX(null)">&#8635;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.shiftX(90)">&#8606;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.shiftX(30)">&#8592;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.shiftX(-30)">&#8594;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.shiftX(-90)">&#8608;</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.shiftX(3.1416)">&#8618;</button>
			      </div>
			      <!--<canvas id="engraving" width="1000" height="100">
			      </canvas>-->
			      <svg height="200px" id="simple_editor" width="100%"></svg>
			      <div id="simple_editor_spinny">
			      </div>
			      <div class="purcell_content">
			        <span class="text-span" id="simple_editor_currentPitch"></span>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.addNoteN(0)">C</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.addNoteN(1)">D</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.addNoteN(2)">E</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.addNoteN(3)">F</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.addNoteN(4)">G</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.addNoteN(5)">A</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.addNoteN(6)">B</button>
			        <button class="pitch" onclick="purcell.$e$$ion$.simple_editor.addNoteN(null)">R</button>
			        <button class="barline" onclick="purcell.$e$$ion$.simple_editor.addBarLineN()">|</button>
			      </div>
			      <hr>
			      <div class="purcell_content">
			        <span class="duration" class="bordered"
			        style="font-size:30px" id="simple_editor_currentRhythm"></span>
			        <button class="duration" onclick="purcell.$e$$ion$.simple_editor.changeDuration(0)">&#xe1d2;</button>
			        <button class="duration" onclick="purcell.$e$$ion$.simple_editor.changeDuration(-1)">&#xe1d3;</button>
			        <button class="duration" onclick="purcell.$e$$ion$.simple_editor.changeDuration(-2)">&#xe1d5;</button>
			        <button class="duration" onclick="purcell.$e$$ion$.simple_editor.changeDuration(-3)">&#xe1d7;</button>
			        <button class="duration" onclick="purcell.$e$$ion$.simple_editor.changeDuration(-4)">&#xe1d9;</button>
			        <button class="duration" onclick="purcell.$e$$ion$.simple_editor.changeDuration(-5)">&#xe1db;</button>
			        <button class="duration" onclick="purcell.$e$$ion$.simple_editor.changeDuration(-6)">&#xe1dd;</button>
			        <button class="duration" onclick="purcell.$e$$ion$.simple_editor.changeDuration(-7)">&#xe1df;</button>
			        &nbsp;
			        <span style="font-size:30px"  class="bordered" id="simple_editor_currentAccidental"></span>
			        &nbsp;
			        <button class="accidental" onclick="purcell.$e$$ion$.simple_editor.changeAccidental(null)">&nbsp;</button>
			        <button class="accidental" onclick="purcell.$e$$ion$.simple_editor.changeAccidental(-1)">&#xe260;</button>
			        <button class="accidental" onclick="purcell.$e$$ion$.simple_editor.changeAccidental(0)">&#xe261;</button>
			        <button class="accidental" onclick="purcell.$e$$ion$.simple_editor.changeAccidental(1)">&#xe262;</button>
			      </div>
			      <hr>
			    <div class="purcell_content">
			    &nbsp;
	              <span class="bordered" style="font-size:30px"  style="width:80px;" id="simple_editor_currentDynamic"></span>
	              &nbsp;&nbsp; &nbsp; <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic(null)">&nbsp;</button>
	              <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic('ppp')">&#58666;</button>
	              <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic('pp')">&#58667;</button>
	              <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic('p')">&#58656;</button>
	              <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic('mp')">&#58668;</button>
	              <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic('mf')">&#58669;</button>
	              <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic('f')">&#58658;</button>
	              <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic('ff')">&#58671;</button>
	              <button class="dynamic" onclick="purcell.$e$$ion$.simple_editor.changeDynamic('fff')">&#58672;</button>
	            </div>
	            <hr>
			      <div class="purcell_content">
			        <span class="text-span" style="font-size:20px;" id="simple_editor_currentOctave"></span>
			        <button class="octave" onclick="purcell.$e$$ion$.simple_editor.changeOctave(-1)">8vb</button>
			        <button class="octave" onclick="purcell.$e$$ion$.simple_editor.changeOctave(1)">8va</button>
			      </div>
			      <hr>
			      <div class="purcell_content">
			        <span class="text-span" style="font-size:20px;" id="simple_editor_currentBeam"></span>
			        <button class="beam" onclick="purcell.$e$$ion$.simple_editor.beamOn()">beam on</button>
			        <button class="beam" onclick="purcell.$e$$ion$.simple_editor.beamOff()">beam off</button>
			      </div>
			    </div>
				  </section>
				<section>
				    <h2>Dynamic SQL Queries</h2>
                    <textarea id="sql_input_simple_editor"
				    style="font-size:20px;width:100%;"
                    rows="10"></textarea>
                    <button class="pitch"
                    onclick="interpret_query_simple_editor()">evaluate</button>
                    <div id="sql_result_simple_editor"></div>
				</section>
				</section>

				<section>
					<h2>Thanks!</h2>
					<p>
					Questions about purcell?  Comments? 
					Like to get involved?  Contact
					<a href="mailto:mike@mikesolomon.org">
					mike@mikesolomon.org</a>.
					</p>
					<svg height="200px" id="page7" width="100%"></svg>
				</section>
			</div>

		</div>

<a target="_blank" href="https://github.com/mikesol/purcell"><img style="position: absolute; top: 0;
right: 0; border: 0;"
src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67"
alt="Fork me on GitHub"
data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
